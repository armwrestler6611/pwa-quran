<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —á—Ç–µ–Ω–∏—è –ö–æ—Ä–∞–Ω–∞</title>

    <!-- PWA: Manifest –∏ —Ü–≤–µ—Ç —Ç–µ–º—ã -->
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#1e40af" />
    <link rel="apple-touch-icon" href="icons/icon-192.png" />

    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen p-4 flex flex-col items-center justify-center">

<div class="w-full max-w-md space-y-4">
    <h1 class="text-2xl font-bold text-center text-blue-400">üìñ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ø–∏—Å–∫–∞ —á—Ç–µ–Ω–∏—è –ö–æ—Ä–∞–Ω–∞</h1>

    <input type="text" id="userName" placeholder="–í–∞—à–µ –∏–º—è" class="w-full p-2 rounded bg-gray-800 border border-gray-600 focus:outline-none" />
    <input type="number" id="selectedNumber" placeholder="–ù–æ–º–µ—Ä —Ä–æ—Ç–∞—Ü–∏–∏" min="1" class="w-full p-2 rounded bg-gray-800 border border-gray-600 focus:outline-none" />

    <button onclick="generateReadingList()" class="w-full bg-blue-600 hover:bg-blue-700 p-2 rounded font-semibold">üîÅ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫</button>

    <div id="resultContainer" class="hidden mt-4 space-y-2">
        <textarea id="resultText" class="w-full h-64 p-2 rounded bg-gray-800 border border-gray-600" readonly></textarea>

        <div class="flex justify-between gap-2">
            <button onclick="sendToWhatsApp()" class="flex-1 bg-green-600 hover:bg-green-700 p-2 rounded font-semibold">üì≤ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ WhatsApp</button>
            <button onclick="downloadFile()" class="flex-1 bg-yellow-500 hover:bg-yellow-600 p-2 rounded font-semibold">üíæ –°–∫–∞—á–∞—Ç—å</button>
        </div>
    </div>
</div>

<script>
    const PAGE_RANGES = [
        '1-10', '11-20', '21-30', '31-40', '41-50',
        '51-60', '61-70', '71-80', '81-90', '91-100',
        '101-110', '111-120', '121-130', '131-140', '141-150',
        '151-160', '161-170', '171-180', '181-190', '191-200',
        '201-210', '211-220', '221-230', '231-240', '241-250',
        '251-260', '261-270', '271-280', '281-290', '291-300',
        '301-310', '311-320', '321-330', '331-340', '341-350',
        '351-360', '361-370', '371-380', '381-390', '391-400',
        '401-410', '411-420', '421-430', '431-440', '441-450',
        '451-460', '461-470', '471-480', '481-490', '491-500',
        '501-510', '511-520', '521-530', '531-540', '541-550',
        '551-560', '561-570', '571-580', '581-590', '591-604'
    ];

    let currentList = '';

    function generateReadingList() {
        const userName = document.getElementById('userName').value.trim();
        const selectedNumber = parseInt(document.getElementById('selectedNumber').value.trim());

        if (!userName || isNaN(selectedNumber)) {
            alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ –Ω–æ–º–µ—Ä —Ä–æ—Ç–∞—Ü–∏–∏.");
            return;
        }

        const shiftedRanges = [...PAGE_RANGES.slice(selectedNumber - 1), ...PAGE_RANGES.slice(0, selectedNumber - 1)];
        const header = createHeaderText(userName, selectedNumber);
        const assignments = shiftedRanges.map((range, idx) => `${idx + 1}. ${range}`).join('\n');
        currentList = header + assignments;
        displayResult(currentList);
    }

    function createHeaderText(userName, selectedNumber) {
        const currentDateTime = new Date().toLocaleString('ru-RU', {
            year: 'numeric', month: '2-digit', day: '2-digit',
            hour: '2-digit', minute: '2-digit'
        });
        return `üìå –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π: ${userName}\nüìÜ –î–∞—Ç–∞: ${currentDateTime}\nüîÑ –ù–æ–º–µ—Ä —Ä–æ—Ç–∞—Ü–∏–∏: ${selectedNumber}\n\nüìñ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü:\n`;
    }

    function displayResult(message) {
        document.getElementById('resultContainer').classList.remove('hidden');
        document.getElementById('resultText').textContent = message;
    }

    function sendToWhatsApp() {
        const encodedMessage = encodeURIComponent(currentList);
        const whatsappUrl = `https://wa.me/?text=${encodedMessage}`;
        window.open(whatsappUrl, '_blank');
    }

    function downloadFile() {
        const blob = new Blob([currentList], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `–°–ø–∏—Å–æ–∫_—á—Ç–µ–Ω–∏—è_${new Date().toISOString().split('T')[0]}.txt`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
    }

    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/service-worker.js')
                .then(() => console.log("‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω"))
                .catch(e => console.error("‚ùå –û—à–∏–±–∫–∞ SW:", e));
        });
    }
</script>
</body>
</html>
